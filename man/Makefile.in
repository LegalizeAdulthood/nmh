#
# Makefile for man subdirectory
#
# $Id$
#

VERSION = @VERSION@

SHELL = /bin/sh

top_srcdir = @top_srcdir@
srcdir     = @srcdir@
VPATH      = @srcdir@

prefix      = @prefix@
exec_prefix = @exec_prefix@
bindir      = @bindir@
libdir      = @libdir@
etcdir      = @sysconfdir@
mandir      = @mandir@
manext1     = 1
manext5     = 5
manext8     = 8

mailspool    = @mailspool@
sendmailpath = @sendmailpath@

default_editor = @editorpath@
default_pager = @pagerpath@

INSTALL      = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

SED = sed
SEDMAN = $(SED) -f man.sed $< > $@

# sed line for editing pop information in man pages
POPSED = @POPSED@

.SUFFIXES:
.SUFFIXES: .man .$(manext1) .$(manext5) .$(manext8)

.man.$(manext1):
	$(SEDMAN)

.man.$(manext5):
	$(SEDMAN)

.man.$(manext8):
	$(SEDMAN)

# include file for the man pages.  It is installed
# in the nmh library directory.
HDR = tmac.h

# input file for header
DIST_HDR = tmac.h.in

# man pages to install in $(mandir)/$(manext1)
MAN1 = ali.$(manext1) anno.$(manext1) burst.$(manext1) comp.$(manext1) \
       dist.$(manext1) flist.$(manext1) folder.$(manext1) forw.$(manext1) \
       inc.$(manext1) mark.$(manext1) mh-chart.$(manext1) nmh.$(manext1) \
       mhbuild.$(manext1) mhl.$(manext1) mhlist.$(manext1) mhmail.$(manext1) \
       mhn.$(manext1) mhparam.$(manext1) mhpath.$(manext1) mhshow.$(manext1) \
       mhstore.$(manext1) msgchk.$(manext1) msh.$(manext1) \
       next.$(manext1) packf.$(manext1) pick.$(manext1) prev.$(manext1) \
       prompter.$(manext1) rcvdist.$(manext1) rcvpack.$(manext1) \
       rcvstore.$(manext1) rcvtty.$(manext1) refile.$(manext1) \
       repl.$(manext1) rmf.$(manext1) rmm.$(manext1) scan.$(manext1) \
       send.$(manext1) sendfiles.$(manext1) show.$(manext1) slocal.$(manext1) \
       sortm.$(manext1) vmh.$(manext1) whatnow.$(manext1) whom.$(manext1)

MAN5 = mh-alias.$(manext5) mh-draft.$(manext5) mh-format.$(manext5) \
       mh-mail.$(manext5) mh-profile.$(manext5) mh-sequence.$(manext5) \
       mh-tailor.$(manext5)

MAN8 = ap.$(manext8) conflict.$(manext8) dp.$(manext8) \
       fmtdump.$(manext8) install-mh.$(manext8) mh-mts.$(manext8) \
       post.$(manext8)

# source for man pages
DIST_MAN = ali.man anno.man ap.man burst.man comp.man conflict.man \
           dist.man dp.man flist.man fmtdump.man folder.man forw.man \
           inc.man install-mh.man mark.man mh-alias.man mh-chart.man \
           mh-draft.man mh-format.man mh-mail.man mh-mts.man mh-profile.man \
           mh-sequence.man mh-tailor.man nmh.man mhbuild.man mhl.man \
           mhlist.man mhmail.man mhn.man mhparam.man mhpath.man \
           mhshow.man mhstore.man msgchk.man msh.man \
           next.man packf.man pick.man post.man prev.man prompter.man \
           rcvdist.man rcvpack.man rcvstore.man rcvtty.man refile.man \
           repl.man rmf.man rmm.man scan.man send.man sendfiles.man show.man \
           slocal.man sortm.man vmh.man whatnow.man whom.man

# auxiliary files
AUX = Makefile.in

# all files in this directory included in the distribution
DIST = $(DIST_HDR) $(DIST_MAN) $(AUX)

# ========= DEFAULT TARGET ==========

all: tmac.h $(MAN1) $(MAN5) $(MAN8)

$(MAN1) $(MAN5) $(MAN8): man.sed

tmac.h: man.sed tmac.h.in
	$(SED) -f man.sed $(srcdir)/tmac.h.in > $@

# create the sed file for building man pages
man.sed: Makefile
	echo 's,%nmhwarning%,THIS FILE HAS BEEN AUTOMATICALLY GENERATED.  DO NOT EDIT.,g' > $@
	echo 's,%nmhversion%,nmh-$(VERSION),g' >> $@
	echo 's,%bindir%,$(bindir),g' >> $@
	echo 's,%etcdir%,$(etcdir),g' >> $@
	echo 's,%libdir%,$(libdir),g' >> $@
	echo 's,%mandir%,$(mandir),g' >> $@
	echo 's,%mailspool%,$(mailspool),g' >> $@
	echo 's,%sendmailpath%,$(sendmailpath),g' >> $@
	echo 's,%default_editor%,$(default_editor),g' >> $@
	echo 's,%default_pager%,$(default_pager),g' >> $@
	echo 's,%manext1%,$(manext1),g' >> $@
	echo 's,%manext5%,$(manext5),g' >> $@
	echo 's,%manext8%,$(manext8),g' >> $@
	echo '$(POPSED)' >> $@

# ========= INSTALL TARGETS =========

install: install-hdr install-man1 install-man5 install-man8

# install the include file for man pages
install-hdr:
	$(top_srcdir)/mkinstalldirs $(etcdir)
	$(INSTALL_DATA) tmac.h $(etcdir)/tmac.h

# install the man pages in man1
install-man1:
	$(top_srcdir)/mkinstalldirs $(mandir)/man$(manext1)
	for file in $(MAN1); do \
	  $(INSTALL_DATA) $$file $(mandir)/man$(manext1) ; \
	done

# install the man pages in man5
install-man5:
	$(top_srcdir)/mkinstalldirs $(mandir)/man$(manext5)
	for file in $(MAN5); do \
	  $(INSTALL_DATA) $$file $(mandir)/man$(manext5) ; \
	done

# install the man pages in man8
install-man8:
	$(top_srcdir)/mkinstalldirs $(mandir)/man$(manext8)
	for file in $(MAN8); do \
	  $(INSTALL_DATA) $$file $(mandir)/man$(manext8) ; \
	done

# ========= UNINSTALL TARGETS =========

uninstall: uninstall-hdr uninstall-man1 uninstall-man5 uninstall-man8

# uninstall the include file for man pages
uninstall-hdr:
	rm -f $(etcdir)/tmac.h

# uninstall the man pages in man1
uninstall-man1:
	for file in $(MAN1); do \
	  rm -f $(mandir)/man$(manext1)/$$file; \
	done

# uninstall the man pages in man5
uninstall-man5:
	for file in $(MAN5); do \
	  rm -f $(mandir)/man$(manext5)/$$file; \
	done

# uninstall the man pages in man8
uninstall-man8:
	for file in $(MAN8); do \
	  rm -f $(mandir)/man$(manext8)/$$file; \
	done

# ========== DEPENDENCIES FOR CLEANUP ==========

mostlyclean:
	rm -f *~

clean: mostlyclean
	rm -f man.sed tmac.h *.$(manext1) *.$(manext5) *.$(manext8)

distclean: clean
	rm -f Makefile

realclean: distclean

superclean: realclean

# ========== DEPENDENCIES FOR MAINTENANCE ==========

subdir = man

Makefile: Makefile.in ../config.status
	cd .. && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= ./config.status
 
distdir = ../`cat ../distname`/$(subdir)
nmhdist: $(DIST)
	@echo "Copying distribution files in $(subdir)"
	@for file in $(DIST); do \
	  cp -p $(srcdir)/$$file $(distdir); \
	done

