#!/bin/sh
#
# Test that the %(myhost) function returns the local hostname and
# the localname entry out of the mts configuration file.
#

if test -z "${MH_OBJ_DIR}"; then
    srcdir=`dirname $0`/../..
    MH_OBJ_DIR=`cd $srcdir && pwd`; export MH_OBJ_DIR
fi

. "$MH_OBJ_DIR/test/common.sh"

setup_test

runtest()
{
	testoutput=$(${MH_LIB_DIR}/ap -format "%(myhost)" ignore)

	if [ x"$1" != x"${testoutput}" ]; then
		echo "For $2, expected $1 but got ${testoutput}"
		exit 1
	fi
}

runtest "$(hostname)" "local hostname test"

cp ${MHMTSCONF} ${MH_TEST_DIR}/Mail/mts.conf || exit 1
export MHMTSCONF="${MH_TEST_DIR}/Mail/mts.conf"

echo "localname: some.random.name" >> ${MHMTSCONF}

runtest "some.random.name" "mts.conf localname test"

exit 0
